---
- name: Check Docker Engine version
  become: true
  shell: ros engine list | grep 'current  {{engine_version}}' > /dev/null
  changed_when: false
  ignore_errors: True
  register: check_docker

- name: Configure Docker Engine
  become: true
  shell: |
    ros config set rancher.docker.extra_args "['--experimental']" && \
    ros engine switch {{engine_version}}
  when: check_docker | failed

- name: Ensure than now is desired Docker Engine version and config
  become: true
  shell: sleep 3 && ros engine list | grep 'current  {{engine_version}}' > /dev/null
  changed_when: false
  when: check_docker | failed

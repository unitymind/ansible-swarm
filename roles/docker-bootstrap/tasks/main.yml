---
- name: Ensure that drop-ins path exists
  become: true
  file:
    path: /etc/systemd/system/docker.service.d
    state: directory
    mode: 0755
  tags:
    - docker

- name: Copy /etc/systemd/system/docker.service.d/10-environment-file.conf
  become: true
  copy:
    src: docker.service.d/10-environment-file.conf
    dest: /etc/systemd/system/docker.service.d/10-environment-file.conf
  notify: Reload
  tags:
    - docker

- name: Check /etc/default/docker
  become: true
  stat:
    path: /etc/default/docker
  register: default_docker
  tags:
    - docker

- block:
  - name: Touch that /etc/default/docker
    become: true
    file:
      path: /etc/default/docker
      state: touch
      mode: 0755
    tags:
      - docker

  - name: Initial empty DOCKER_OPTS
    become: true
    lineinfile:
      dest: /etc/default/docker
      line: 'DOCKER_OPTS=""'
      state: present
    notify: Reload
    tags:
      - docker
  when: default_docker.stat.exists == False

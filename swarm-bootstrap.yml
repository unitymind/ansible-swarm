- hosts: manager, worker
  roles:
    - role: docker-swarm-grouping
      tags: ['docker', 'swarm']

- hosts: swarm_manager_bootstrap
  roles:
    - role: docker-swarm-init
      when: >
        'swarm_manager_operational' not in groups
      tags:
        - docker
        - swarm

- hosts: swarm_manager_operational
  roles:
    - role: docker-swarm-retrieve-tokens
      tags:
        - docker
        - swarm

- hosts: swarm_bootstrap
  roles:
    - role: docker-swarm-join
      when: >
        (groups['swarm_manager_operational'] is defined)
        and
        (inventory_hostname not in groups['swarm_manager_operational'])
      tags:
        - docker
        - swarm

- hosts: manager, worker
  roles:
    - role: docker-swarm-grouping
      tags:
        - docker
        - swarm

- hosts: swarm_manager_bootstrap
  roles:
    - role: docker-swarm-init
      when: >
        'swarm_manager_operational' not in groups
      tags:
        - docker
        - swarm

- hosts: manager, worker
  roles:
    - role: docker-swarm-join
      when: >
        (groups['swarm_manager_operational'] is defined)
        and
        (groups['swarm_bootstrap'] is defined)
      tags:
        - docker
        - swarm
